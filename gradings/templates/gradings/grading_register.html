{% extends 'layout.html' %}
{% load static %}
{% load extra_filters %}

{% block title %}Register â€“ {{ grading.class_name }}{% endblock %}

{% block content %}
<div class="container py-4">

  <!-- Page Heading -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h1 class="text-glow">ðŸ“‹ Register â€“ {{ grading.class_name }}</h1>
    <a href="{% url 'gradings:grading_list' %}" class="btn btn-secondary">â¬… Back to Gradings</a>
  </div>

  <!-- Grading Info -->
  <p>
    <strong>Instructor:</strong> {{ grading.instructor }}<br>
    <strong>Date:</strong> {{ grading.start_time|date:"d M Y H:i" }}
  </p>

  <!-- Update this action URL to use the correct URL name and namespace -->
  <form method="POST" action="{% url 'gradings:save_grading_register' grading.id %}">
    {% csrf_token %}

    <!-- Members Table -->
    <div class="tile">
      <h4 class="mb-3">âœ… Mark Attendance</h4>
      <table class="table table-dark table-striped table-bordered rounded align-middle">
        <thead>
          <tr>
            <th>Photo</th>
            <th>Name</th>
            <th>Present</th>
          </tr>
        </thead>
        <tbody>
          {% for member in members %}
          <tr>
            <td>
              {% if member.profile_picture %}
                <img src="{{ member.profile_picture.url }}" alt="{{ member.first_name }}" class="img-thumbnail" style="max-height: 110px; max-width: 110px;">
              {% else %}
                <span class="text-muted">No photo</span>
              {% endif %}
            </td>
            <td>{{ member.first_name }} {{ member.last_name }}</td>
            <td>
              <input type="checkbox" name="attendance" value="{{ member.id }}"
                {% if member.present %}checked{% endif %}>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <!-- Save Button -->
    <div class="mt-4 d-flex justify-content-end">
      <button type="submit" class="btn btn-primary">ðŸ’¾ Save Register</button>
    </div>
  </form>
</div>
{% endblock %}
